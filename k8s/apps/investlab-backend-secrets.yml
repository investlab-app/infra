apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: investlab-backend-secrets
  namespace: backend
  labels:
    app.kubernetes.io/name: investlab-backend
    app.kubernetes.io/component: api
    app.kubernetes.io/part-of: investlab
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: oci-vault
    kind: ClusterSecretStore
  target:
    name: investlab-backend-secrets
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        DATABASE_PASSWORD: "{{ .database-password }}"
        CLERK_SECRET_KEY: "{{ .clerk-secret-key }}"
        POLYGON_SECRET_KEY: "{{ .polygon-secret-key }}"
        ALPACA_SECRET_KEY: "{{ .alpaca-secret-key }}"
        MINIO_ACCESS_KEY: "{{ .minio-access-key }}"
        MINIO_SECRET_KEY: "{{ .minio-secret-key }}"
  data:
    - secretKey: database-password
      remoteRef:
        key: postgres-password
    - secretKey: clerk-secret-key
      remoteRef:
        key: clerk-secret-key
    - secretKey: polygon-secret-key
      remoteRef:
        key: polygon-secret-key
    - secretKey: alpaca-secret-key
      remoteRef:
        key: alpaca-secret-key
    - secretKey: minio-access-key
      remoteRef:
        key: minio-access-key
    - secretKey: minio-secret-key
      remoteRef:
        key: minio-secret-key
